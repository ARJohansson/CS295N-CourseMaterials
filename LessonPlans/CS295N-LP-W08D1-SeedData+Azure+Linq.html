<!DOCTYPE html><html>  <head>    <meta http-equiv="content-type" content="text/html; charset=UTF-8">    <title>Week 8, Day 1, Linq +Azure</title>    <style type="text/css">body {  font-family: "Arial", "Helvetica", "sans-serif";}footer {	font-size:smaller;	font-variant:small-caps;}#week08 {  background-color: #f8ff2e;}code {  display:block;  font-size: larger;  background-color: lightgoldenrodyellow;  max-height:450px;  width:85%;  overflow:scroll;  margin:0.5%;}      ul {   margin:0.5%;}      h2, h3, h4 {   display:inline;}      .exercise {  background-color: #c6ffe2;}</style> </head>  <body> <b>CS295N Web Development 1: ASP.NET </b><br>    <b> </b>    <header>      <div>Brian Bird</div>      <h1> <i><b>More EF, LINQ and Publishing to Azure </b></i></h1>      <b>Where we are </b>      <table style="width: 807px; height: 127px;" border="1">        <tbody>          <tr>            <td id="week01">1. Intro to MVC</td>            <td id="week06">6. Unit Testing and Repositories</td>          </tr>          <tr>            <td id="week02">2. Domain Modeling</td>            <td id="week07">7. Entity Framework (EF)</td>          </tr>          <tr>            <td id="week03">3. C# Review / Advanced C# for MVC</td>            <td id="week08">8. More on EF + LINQ + Azure</td>          </tr>          <tr>            <td id="week04">4. Razor Views and Tag Helpers</td>            <td id="week09">9. Model Binding / Validation</td>          </tr>          <tr>            <td id="week05">5. Azure, Web Dev Tools and Debugging</td>            <td id="week10">10. Configuration / URL routing</td>          </tr>        </tbody>      </table>      <br>      <h2><b>Contents</b></h2>      <div>        <ul>          <b>            <li><a href="#topic1">Introduction</a></li>            <li><a href="#topic2">Review </a></li>            <li><a href="#topic3a">Seeding Your Database</a></li>          </b><b>            <li><a href="#topic5a">Running Unit Tests</a></li>            <li><a href="#topic6">Example</a></li>            <li><a href="#topic7">Reference</a></li>            <li><a href="#topic8">Next Class</a></li>          </b>        </ul>      </div>    </header>    <br>    <hr><br>    <section>      <article id="topic1">        <h2>Introduction</h2>        <ul>          <li>Announcements</li>        </ul>        <ul>          <li>Review lab due dates on Moodle</li>          <li>Discuss questions about the previous lab</li>        </ul>      </article>      <br>      <hr><br>      <article id="topic4a">        <h2>Seeding Your Database</h2>        <ul>          <li>The method to seed the database should be called from startup. I            put mine in a static class named SeedData, but it's not a special            name (not part of a convention), nor is the method name I used.<br>            <code>public class SeedData<br>              { public static void Seed(IServiceProvider services)<br>              <br>              &nbsp; {&nbsp; AppDbContext context =              services.GetRequiredService&lt;AppDbContext&gt;();<br>              &nbsp;&nbsp;&nbsp;&nbsp; context.Database.EnsureCreated();<br>              <br>              &nbsp;&nbsp;&nbsp;&nbsp; if (!context.Books.Any()) {<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Author author = new Author {              Name = "Samuel Shellabarger" };<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.Authors.Add(author);<br>              <br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; User user = new User { Name =              "Walter Cronkite" };<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.Users.Add(user);<br>              <br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Review review = new Review<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ReviewText              = "Great book, a must read!",<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Reviewer =              user<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.Reviews.Add(review);<br>              <br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Book book = new Book<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Title = "Prince              of Foxes",<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PubDate =              DateTime.Parse("1/1/1947")<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; book.Authors.Add(author);<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; book.Reviews.Add(review);<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.Books.Add(book);<br>              <br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.SaveChanges(); //              save all the data<br>              &nbsp;&nbsp;&nbsp;&nbsp; }<br>              &nbsp; }<br>              }</code> </li>          <li>The Seed method gets called when you run the CLI command:<span style="font-family:              Courier New,Courier,monospace;"> </span>            <p><span style="font-family:              Courier New,Courier,monospace;">dotnet ef databa</span><span style="font-family: Courier New,Courier,monospace;">se
                update</span></p>          </li>        </ul>        <ul>        </ul>      </article>      <hr><br>      <article id="topic5a">        <h2>Running Unit Tests </h2>        <br>        Adding EF should not have broken any of your unit tests. But it's good        practice to run the tests before pushing our code to the central        repository (on GitHub).<br>      </article>      <br>      <hr> <br>      <article id="topic6">        <h2>Example</h2>        <br>        <a href="https://github.com/LCC-CIT/CS295N-Bookinfo-Core-21/tree/EF" target="_blank">BookInfo,
          branch EF</a> </article>      <br>      <hr> <br>      <article id="topic8">        <h2>References</h2>        <ul>          <li>Textbook - <span style="font-style: italic;">Pro ASP.NET Core MVC              2.0</span>, Adam Freeman, Apress, 2017.<br>            Ch. 8 "Sports Store, a Real Application", section titled,<br>            "Preparing a Database" (page 208), with sub-sections:            <ul>              <li>Installing the Entity Framework Core Tools Package </li>              <li>Creating the Database Classes </li>              <li>Creating the Repository Class </li>              <li>Defining the Connection String </li>              <li>Configuring the Application                <ul>                  <li>&nbsp;"Disabling Scope Verification"</li>                </ul>              </li>              <li>Creating the Database Migration&nbsp;</li>              <li>Creating the Seed Data </li>            </ul>          </li>          <li>Microsoft Docs: <a href="https://docs.microsoft.com/en-us/ef/core/"              target="_blank">Entity
              Framework Core</a></li>          <li>Microsoft Tutorial: <a href="https://docs.microsoft.com/en-us/aspnet/core/data/ef-mvc/"              target="_blank">Get
              started with ASP.NET Core MVC and Entity Framework Core using              Visual Studio</a></li>          <li>.NET Core API Reference: <a href="https://docs.microsoft.com/en-us/dotnet/api/system.componentmodel.dataannotations?view=netcore-2.1"              target="_blank">System.ComponentModel.DataAnnotations
              Namespace</a></li>          <li>Microsoft Reference: <a href="https://docs.microsoft.com/en-us/ef/core/miscellaneous/cli/dotnet"              target="_blank">Entity
              Framework Core tools reference - .NET CLI</a></li>          <li>Microsoft tutorial: <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/dependency-injection"              target="_blank">Dependency
              Injection in ASP.NET Core</a></li>        </ul>        <ul>        </ul>      </article>    </section>    <footer>      <hr style="width: 100%; height: 2px;"><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img          alt="Creative Commons License"          style="border-width:0"          src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a><br>      <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">ASP.NET        Core MVC Lecture Notes</span> by <a xmlns:cc="http://creativecommons.org/ns#"        href="https://birdsbits.blog"        property="cc:attributionName"        rel="cc:attributionURL">Brian
        Bird</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
        Commons Attribution-ShareAlike 4.0 International License</a>. </footer>    <hr>  </body></html>